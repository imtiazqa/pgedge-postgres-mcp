=== RUN   TestMCPServerTestSuite
    base.go:165: Loaded configuration from: /Users/imtiaz/Documents/pgedge-postgres-mcp/AItoolsFramework/mcp-server/config/container.yaml (environment: dev)
    base.go:206: Executor initialized: container-systemd
    base.go:208: Container image: jrei/systemd-ubuntu:22.04 (systemd: true)
    base.go:62: Test suite started at 2026-01-08T13:34:39+05:00
    e2e.go:34: E2E Suite initialized
    e2e.go:329: Installing pgEdge repository...
    install.go:44: Installing repository on Debian/Ubuntu system...
    install.go:59: Downloading and installing pgedge-release package...
    install.go:61: Using repository URL: https://apt.pgedge.com/repodeb/pgedge-release_latest_all.deb
    install.go:77: Updating package lists...
    install.go:83: Verifying repository is available...
    install.go:89: ‚úì Debian repository installed successfully
    e2e.go:349: Installing PostgreSQL...
    install.go:151: Installing PostgreSQL 17...
    install.go:154: Step 1: Installing PostgreSQL 17 packages
    install.go:162: Step 2: Initializing PostgreSQL 17 database
    install.go:231:   Starting PostgreSQL with default authentication...
    install.go:170: Step 3: Setting postgres user password
    install.go:179: Step 3.5: Configuring password-based authentication
    install.go:244:   Configuring PostgreSQL md5 authentication...
    install.go:271:   ‚úì PostgreSQL authentication configured for md5
    install.go:187: Step 4: Creating MCP database
    install.go:202: ‚Ñπ Using existing system database: postgres
    install.go:205: ‚úì PostgreSQL installed and configured successfully
    e2e.go:369: Installing MCP server packages...
    install.go:375: Configuring database password...
    install.go:387: ‚úì All MCP server packages installed and configured successfully
    suite_test.go:31: MCP Server Test Suite initialized - all packages installed
=== RUN   TestMCPServerTestSuite/Test01_RepositoryInstallation
    base.go:75: Test started: TestMCPServerTestSuite/Test01_RepositoryInstallation
    regression_suite_test.go:26: === Test 01: Repository Installation ===
=== RUN   TestMCPServerTestSuite/Test01_RepositoryInstallation/Repository_Installation
    repository_test.go:8: Testing repository installation...
    repository_test.go:18: ‚úì pgEdge apt repository is installed
=== RUN   TestMCPServerTestSuite/Test01_RepositoryInstallation/Repository_PackageAvailability
    repository_test.go:30: Testing package availability in repository...
    repository_test.go:52:   ‚úì Package pgedge-postgres-mcp is available in repository
    repository_test.go:52:   ‚úì Package pgedge-nla-cli is available in repository
    repository_test.go:52:   ‚úì Package pgedge-nla-web is available in repository
    repository_test.go:52:   ‚úì Package pgedge-postgres-mcp-kb is available in repository
=== NAME  TestMCPServerTestSuite/Test01_RepositoryInstallation
    base.go:92: Test PASS: TestMCPServerTestSuite/Test01_RepositoryInstallation (duration: 3.489764542s)
=== RUN   TestMCPServerTestSuite/Test02_PostgreSQLSetup
    base.go:75: Test started: TestMCPServerTestSuite/Test02_PostgreSQLSetup
    regression_suite_test.go:35: === Test 02: PostgreSQL Setup ===
=== RUN   TestMCPServerTestSuite/Test02_PostgreSQLSetup/PostgreSQL_Installation
    postgresql_test.go:10: Testing PostgreSQL installation...
    postgresql_test.go:18: ‚úì PostgreSQL installed successfully
=== RUN   TestMCPServerTestSuite/Test02_PostgreSQLSetup/PostgreSQL_ServiceStatus
    postgresql_test.go:22: Testing PostgreSQL service status...
    postgresql_test.go:29: PostgreSQL service status: inactive
         (exit code: 3)
    postgresql_test.go:30: Note: PostgreSQL may be running without systemd in container environment
=== RUN   TestMCPServerTestSuite/Test02_PostgreSQLSetup/PostgreSQL_DatabaseConnection
    postgresql_test.go:35: Testing PostgreSQL database connection...
    postgresql_test.go:48: ‚úì PostgreSQL database connection successful
=== RUN   TestMCPServerTestSuite/Test02_PostgreSQLSetup/PostgreSQL_MCPDatabase
    postgresql_test.go:56: Testing MCP database exists...
    postgresql_test.go:68: MCP database check:  (exit code: 1)
    postgresql_test.go:69: Note: MCP database may need to be created
=== NAME  TestMCPServerTestSuite/Test02_PostgreSQLSetup
    base.go:92: Test PASS: TestMCPServerTestSuite/Test02_PostgreSQLSetup (duration: 318.50125ms)
=== RUN   TestMCPServerTestSuite/Test03_MCPServerInstallation
    base.go:75: Test started: TestMCPServerTestSuite/Test03_MCPServerInstallation
    regression_suite_test.go:46: === Test 03: MCP Server Installation ===
=== RUN   TestMCPServerTestSuite/Test03_MCPServerInstallation/MCPServer_PackagesInstalled
    mcp_server_test.go:10: Testing MCP server packages are installed...
    mcp_server_test.go:29:   ‚úì Package installed: pgedge-postgres-mcp
    mcp_server_test.go:29:   ‚úì Package installed: pgedge-nla-cli
    mcp_server_test.go:29:   ‚úì Package installed: pgedge-nla-web
    mcp_server_test.go:29:   ‚úì Package installed: pgedge-postgres-mcp-kb
    mcp_server_test.go:35: ‚úì Package verification complete
=== RUN   TestMCPServerTestSuite/Test03_MCPServerInstallation/Installation_MCPPackages
    installation_test.go:10: Testing MCP package installation...
    installation_test.go:22: ‚úì All MCP packages installed correctly
=== RUN   TestMCPServerTestSuite/Test03_MCPServerInstallation/Installation_Repository
    installation_test.go:46: Testing repository installation...
    installation_test.go:64: ‚úì Repository installed and available
=== NAME  TestMCPServerTestSuite/Test03_MCPServerInstallation
    base.go:92: Test PASS: TestMCPServerTestSuite/Test03_MCPServerInstallation (duration: 1.27129125s)
=== RUN   TestMCPServerTestSuite/Test04_InstallationValidation
    base.go:75: Test started: TestMCPServerTestSuite/Test04_InstallationValidation
    regression_suite_test.go:56: === Test 04: Installation Validation ===
=== RUN   TestMCPServerTestSuite/Test04_InstallationValidation/Installation_PackageFiles
    installation_test.go:26: Testing package file installation...
    installation_test.go:42: ‚úì Package files have correct permissions
=== RUN   TestMCPServerTestSuite/Test04_InstallationValidation/MCPServer_BinaryFunctional
    mcp_server_test.go:39: Testing MCP server binary is functional...
    mcp_server_test.go:49: ‚úì MCP server binary is functional
=== RUN   TestMCPServerTestSuite/Test04_InstallationValidation/MCPServer_ConfigValid
    mcp_server_test.go:53: Testing MCP server configuration is valid...
    mcp_server_test.go:67: ‚úì MCP server configuration is valid
=== RUN   TestMCPServerTestSuite/Test04_InstallationValidation/MCPServer_EnvironmentFile
    mcp_server_test.go:71: Testing MCP server environment file...
    mcp_server_test.go:86: ‚úì MCP server environment file is configured
=== NAME  TestMCPServerTestSuite/Test04_InstallationValidation
    base.go:92: Test PASS: TestMCPServerTestSuite/Test04_InstallationValidation (duration: 301.222958ms)
=== RUN   TestMCPServerTestSuite/Test05_TokenManagement
    base.go:75: Test started: TestMCPServerTestSuite/Test05_TokenManagement
    regression_suite_test.go:67: === Test 05: Token Management ===
=== RUN   TestMCPServerTestSuite/Test05_TokenManagement/Token_FileExists
    token_test.go:54: Testing token file can be created...
    token_test.go:59: Cleaning up token file from previous runs...
    token_test.go:65:   ‚Ñπ Token file doesn't exist yet (will be created on first token creation)
    token_test.go:74: ‚úì Token file location is accessible
=== RUN   TestMCPServerTestSuite/Test05_TokenManagement/Token_CreateToken
    token_test.go:13: Testing token creation...
    token_test.go:34: ‚úì Token created successfully
=== RUN   TestMCPServerTestSuite/Test05_TokenManagement/Token_ListTokens
    token_test.go:38: Testing token listing...
    token_test.go:50: ‚úì Token listing successful
=== NAME  TestMCPServerTestSuite/Test05_TokenManagement
    base.go:92: Test PASS: TestMCPServerTestSuite/Test05_TokenManagement (duration: 401.690167ms)
=== RUN   TestMCPServerTestSuite/Test06_UserManagement
    base.go:75: Test started: TestMCPServerTestSuite/Test06_UserManagement
    regression_suite_test.go:77: === Test 06: User Management ===
=== RUN   TestMCPServerTestSuite/Test06_UserManagement/User_CreateUser
    user_test.go:13: Testing user creation...
    user_test.go:21: Cleaning up any existing test user...
    user_test.go:34: ‚úì User created successfully
=== RUN   TestMCPServerTestSuite/Test06_UserManagement/User_ListUsers
    user_test.go:38: Testing user listing...
    user_test.go:50: ‚úì User listing successful
=== RUN   TestMCPServerTestSuite/Test06_UserManagement/User_FilePermissions
    user_test.go:54: Testing user file permissions...
    user_test.go:68: ‚úì User file has correct permissions
=== NAME  TestMCPServerTestSuite/Test06_UserManagement
    base.go:92: Test PASS: TestMCPServerTestSuite/Test06_UserManagement (duration: 581.108ms)
=== RUN   TestMCPServerTestSuite/Test07_PackageFilesVerification
    base.go:75: Test started: TestMCPServerTestSuite/Test07_PackageFilesVerification
    regression_suite_test.go:87: === Test 07: Package Files Verification ===
=== RUN   TestMCPServerTestSuite/Test07_PackageFilesVerification/Files_BinariesExist
    files_test.go:10: Testing binaries...
    files_test.go:31:   ‚úì /usr/bin/pgedge-postgres-mcp exists with correct permissions (755)
    files_test.go:31:   ‚úì /usr/bin/pgedge-nla-kb-builder exists with correct permissions (755)
    files_test.go:31:   ‚úì /usr/bin/pgedge-nla-cli exists with correct permissions (755)
=== RUN   TestMCPServerTestSuite/Test07_PackageFilesVerification/Files_ConfigFiles
    files_test.go:53: Testing configuration files...
    files_test.go:78:   ‚úì /etc/pgedge/postgres-mcp.env exists with correct permissions (644)
    files_test.go:78:   ‚úì /etc/pgedge/pgedge-nla-kb-builder.yaml exists with correct permissions (644)
    files_test.go:78:   ‚úì /etc/pgedge/nla-cli.yaml exists with correct permissions (644)
    files_test.go:78:   ‚úì /etc/pgedge/postgres-mcp.yaml exists with correct permissions (644)
=== RUN   TestMCPServerTestSuite/Test07_PackageFilesVerification/Files_DataDirectory
    files_test.go:83: Testing data directory...
    files_test.go:102:   ‚úì /var/lib/pgedge/postgres-mcp exists with correct ownership (pgedge:pgedge)
=== RUN   TestMCPServerTestSuite/Test07_PackageFilesVerification/Files_LogDirectories
    files_test.go:106: Testing log directories...
    files_test.go:121:   ‚úì /var/log/pgedge/postgres-mcp exists
    files_test.go:121:   ‚úì /var/log/pgedge/nla-web exists
=== RUN   TestMCPServerTestSuite/Test07_PackageFilesVerification/Files_SystemdService
    files_test.go:36: Testing systemd service file...
    files_test.go:49:   ‚úì /usr/lib/systemd/system/pgedge-postgres-mcp.service exists with correct permissions (644)
=== NAME  TestMCPServerTestSuite/Test07_PackageFilesVerification
    base.go:92: Test PASS: TestMCPServerTestSuite/Test07_PackageFilesVerification (duration: 1.505193417s)
=== RUN   TestMCPServerTestSuite/Test08_ServiceManagement
    base.go:75: Test started: TestMCPServerTestSuite/Test08_ServiceManagement
    regression_suite_test.go:99: === Test 08: Service Management ===
=== RUN   TestMCPServerTestSuite/Test08_ServiceManagement/Service_MCPServerBinary
    service_test.go:10: Testing MCP server binary...
    service_test.go:20: ‚úì MCP server binary is functional
=== NAME  TestMCPServerTestSuite/Test08_ServiceManagement
    base.go:92: Test PASS: TestMCPServerTestSuite/Test08_ServiceManagement (duration: 71.881125ms)
=== RUN   TestMCPServerTestSuite/Test09_KnowledgeBuilder
    base.go:75: Test started: TestMCPServerTestSuite/Test09_KnowledgeBuilder
    regression_suite_test.go:107: === Test 09: Knowledge Builder ===
=== RUN   TestMCPServerTestSuite/Test09_KnowledgeBuilder/KB_BuilderBinary
    kb_test.go:10: Testing KB builder binary...
    kb_test.go:20: KB builder output: kb-builder processes documentation from various sources (Git repos, local paths)
        and builds a searchable SQLite database with vector embeddings for use with the
        pgEdge PostgreSQL MCP server.
        
        The tool converts documents from multiple formats (Markdown, HTML, RST, SGML),
        chunks them intelligently, generates embeddings using multiple providers (OpenAI,
        Voyage, Ollama), and stores everything in an optimized SQLite database.
        
        Usage:
          kb-builder [flags]
        
        Flags:
              --add-missing-embeddings    Add missing embeddings to existing database instead of rebuilding
              --clear-embeddings string   Clear embeddings for specified provider (openai, voyage, or ollama)
          -c, --config string             Path to configuration file (default: looks in binary directory)
          -d, --database string           Path to output SQLite database (overrides config file)
          -h, --help                      help for kb-builder
              --skip-updates              Skip git pull updates for existing repositories
    kb_test.go:22: ‚úì KB builder binary available
=== RUN   TestMCPServerTestSuite/Test09_KnowledgeBuilder/MCPKB_BuilderBinary
    mcp_kb_test.go:10: Testing KB builder binary...
    mcp_kb_test.go:23: ‚úì KB builder binary is available and executable
=== RUN   TestMCPServerTestSuite/Test09_KnowledgeBuilder/MCPKB_BuilderHelp
    mcp_kb_test.go:27: Testing KB builder help command...
    mcp_kb_test.go:39: ‚úì KB builder help command works
=== NAME  TestMCPServerTestSuite/Test09_KnowledgeBuilder
    base.go:92: Test PASS: TestMCPServerTestSuite/Test09_KnowledgeBuilder (duration: 342.964792ms)
=== RUN   TestMCPServerTestSuite/Test10_MCPServerWithKB
    base.go:75: Test started: TestMCPServerTestSuite/Test10_MCPServerWithKB
    regression_suite_test.go:117: === Test 10: MCP Server with Knowledge Base ===
=== RUN   TestMCPServerTestSuite/Test10_MCPServerWithKB/MCPKB_ConfigFile
    mcp_kb_test.go:43: Testing KB builder configuration file...
    mcp_kb_test.go:56: ‚úì KB builder configuration file exists
=== RUN   TestMCPServerTestSuite/Test10_MCPServerWithKB/MCPKB_DefaultDatabaseLocation
    mcp_kb_test.go:60: Testing KB default database location...
    mcp_kb_test.go:74:   ‚Ñπ No default KB database found (this is normal for fresh installation)
=== NAME  TestMCPServerTestSuite/Test10_MCPServerWithKB
    base.go:92: Test PASS: TestMCPServerTestSuite/Test10_MCPServerWithKB (duration: 297.703167ms)
=== RUN   TestMCPServerTestSuite/Test11_StdioMode
    base.go:75: Test started: TestMCPServerTestSuite/Test11_StdioMode
    regression_suite_test.go:126: === Test 11: Stdio Mode ===
=== RUN   TestMCPServerTestSuite/Test11_StdioMode/Stdio_BinarySupportsStdio
    stdio_test.go:44: Testing MCP server supports stdio mode...
    stdio_test.go:55: ‚úì MCP server binary supports stdio mode
=== RUN   TestMCPServerTestSuite/Test11_StdioMode/Stdio_ConfigurationFile
    stdio_test.go:10: Testing stdio mode configuration...
    stdio_test.go:40: ‚úì Stdio configuration file created
=== NAME  TestMCPServerTestSuite/Test11_StdioMode
    base.go:92: Test PASS: TestMCPServerTestSuite/Test11_StdioMode (duration: 235.894333ms)

[96;100;1m üß™ Test Suite Summary                                          [0m
[106;30m  # [0m[106;30m TEST NAME                       [0m[106;30m STATUS          [0m[106;30m DURATION [0m
[107;30m  1 [0m[107;30m Test01_RepositoryInstallation   [0m[107;30m [32m‚úì PASS[0m[107;30m          [0m[107;30m   3.490s [0m
[47;30m  2 [0m[47;30m Test02_PostgreSQLSetup          [0m[47;30m [32m‚úì PASS[0m[47;30m          [0m[47;30m   0.319s [0m
[107;30m  3 [0m[107;30m Test03_MCPServerInstallation    [0m[107;30m [32m‚úì PASS[0m[107;30m          [0m[107;30m   1.271s [0m
[47;30m  4 [0m[47;30m Test04_InstallationValidation   [0m[47;30m [32m‚úì PASS[0m[47;30m          [0m[47;30m   0.301s [0m
[107;30m  5 [0m[107;30m Test05_TokenManagement          [0m[107;30m [32m‚úì PASS[0m[107;30m          [0m[107;30m   0.402s [0m
[47;30m  6 [0m[47;30m Test06_UserManagement           [0m[47;30m [32m‚úì PASS[0m[47;30m          [0m[47;30m   0.581s [0m
[107;30m  7 [0m[107;30m Test07_PackageFilesVerification [0m[107;30m [32m‚úì PASS[0m[107;30m          [0m[107;30m   1.505s [0m
[47;30m  8 [0m[47;30m Test08_ServiceManagement        [0m[47;30m [32m‚úì PASS[0m[47;30m          [0m[47;30m   0.072s [0m
[107;30m  9 [0m[107;30m Test09_KnowledgeBuilder         [0m[107;30m [32m‚úì PASS[0m[107;30m          [0m[107;30m   0.343s [0m
[47;30m 10 [0m[47;30m Test10_MCPServerWithKB          [0m[47;30m [32m‚úì PASS[0m[47;30m          [0m[47;30m   0.298s [0m
[107;30m 11 [0m[107;30m Test11_StdioMode                [0m[107;30m [32m‚úì PASS[0m[107;30m          [0m[107;30m   0.236s [0m
[106;30m    [0m[106;30m TOTAL: 11 TESTS                 [0m[106;30m 11/11 PASSED ‚ú® [0m[106;30m 313.953S [0m

üìã Execution Mode: [36mcontainer-systemd[0m
üê≥ OS Image: [36mjrei/systemd-ubuntu:22.04[0m
üü¢ Server Environment: [36mlive[0m
üêò PostgreSQL Version: [36m17[0m
üì¶ Repository: [36mhttps://apt.pgedge.com/repodeb/pgedge-release_latest_all.deb[0m
‚è±Ô∏è  Total Duration: [36m5m13.953s[0m

--- PASS: TestMCPServerTestSuite (313.95s)
    --- PASS: TestMCPServerTestSuite/Test01_RepositoryInstallation (3.49s)
        --- PASS: TestMCPServerTestSuite/Test01_RepositoryInstallation/Repository_Installation (0.63s)
        --- PASS: TestMCPServerTestSuite/Test01_RepositoryInstallation/Repository_PackageAvailability (2.85s)
    --- PASS: TestMCPServerTestSuite/Test02_PostgreSQLSetup (0.32s)
        --- PASS: TestMCPServerTestSuite/Test02_PostgreSQLSetup/PostgreSQL_Installation (0.07s)
        --- PASS: TestMCPServerTestSuite/Test02_PostgreSQLSetup/PostgreSQL_ServiceStatus (0.07s)
        --- PASS: TestMCPServerTestSuite/Test02_PostgreSQLSetup/PostgreSQL_DatabaseConnection (0.09s)
        --- PASS: TestMCPServerTestSuite/Test02_PostgreSQLSetup/PostgreSQL_MCPDatabase (0.09s)
    --- PASS: TestMCPServerTestSuite/Test03_MCPServerInstallation (1.27s)
        --- PASS: TestMCPServerTestSuite/Test03_MCPServerInstallation/MCPServer_PackagesInstalled (0.34s)
        --- PASS: TestMCPServerTestSuite/Test03_MCPServerInstallation/Installation_MCPPackages (0.31s)
        --- PASS: TestMCPServerTestSuite/Test03_MCPServerInstallation/Installation_Repository (0.62s)
    --- PASS: TestMCPServerTestSuite/Test04_InstallationValidation (0.30s)
        --- PASS: TestMCPServerTestSuite/Test04_InstallationValidation/Installation_PackageFiles (0.11s)
        --- PASS: TestMCPServerTestSuite/Test04_InstallationValidation/MCPServer_BinaryFunctional (0.04s)
        --- PASS: TestMCPServerTestSuite/Test04_InstallationValidation/MCPServer_ConfigValid (0.06s)
        --- PASS: TestMCPServerTestSuite/Test04_InstallationValidation/MCPServer_EnvironmentFile (0.09s)
    --- PASS: TestMCPServerTestSuite/Test05_TokenManagement (0.40s)
        --- PASS: TestMCPServerTestSuite/Test05_TokenManagement/Token_FileExists (0.20s)
        --- PASS: TestMCPServerTestSuite/Test05_TokenManagement/Token_CreateToken (0.12s)
        --- PASS: TestMCPServerTestSuite/Test05_TokenManagement/Token_ListTokens (0.08s)
    --- PASS: TestMCPServerTestSuite/Test06_UserManagement (0.58s)
        --- PASS: TestMCPServerTestSuite/Test06_UserManagement/User_CreateUser (0.37s)
        --- PASS: TestMCPServerTestSuite/Test06_UserManagement/User_ListUsers (0.07s)
        --- PASS: TestMCPServerTestSuite/Test06_UserManagement/User_FilePermissions (0.15s)
    --- PASS: TestMCPServerTestSuite/Test07_PackageFilesVerification (1.51s)
        --- PASS: TestMCPServerTestSuite/Test07_PackageFilesVerification/Files_BinariesExist (0.43s)
        --- PASS: TestMCPServerTestSuite/Test07_PackageFilesVerification/Files_ConfigFiles (0.57s)
        --- PASS: TestMCPServerTestSuite/Test07_PackageFilesVerification/Files_DataDirectory (0.22s)
        --- PASS: TestMCPServerTestSuite/Test07_PackageFilesVerification/Files_LogDirectories (0.14s)
        --- PASS: TestMCPServerTestSuite/Test07_PackageFilesVerification/Files_SystemdService (0.15s)
    --- PASS: TestMCPServerTestSuite/Test08_ServiceManagement (0.07s)
        --- PASS: TestMCPServerTestSuite/Test08_ServiceManagement/Service_MCPServerBinary (0.07s)
    --- PASS: TestMCPServerTestSuite/Test09_KnowledgeBuilder (0.34s)
        --- PASS: TestMCPServerTestSuite/Test09_KnowledgeBuilder/KB_BuilderBinary (0.13s)
        --- PASS: TestMCPServerTestSuite/Test09_KnowledgeBuilder/MCPKB_BuilderBinary (0.14s)
        --- PASS: TestMCPServerTestSuite/Test09_KnowledgeBuilder/MCPKB_BuilderHelp (0.07s)
    --- PASS: TestMCPServerTestSuite/Test10_MCPServerWithKB (0.30s)
        --- PASS: TestMCPServerTestSuite/Test10_MCPServerWithKB/MCPKB_ConfigFile (0.15s)
        --- PASS: TestMCPServerTestSuite/Test10_MCPServerWithKB/MCPKB_DefaultDatabaseLocation (0.15s)
    --- PASS: TestMCPServerTestSuite/Test11_StdioMode (0.24s)
        --- PASS: TestMCPServerTestSuite/Test11_StdioMode/Stdio_BinarySupportsStdio (0.08s)
        --- PASS: TestMCPServerTestSuite/Test11_StdioMode/Stdio_ConfigurationFile (0.15s)
PASS
ok  	github.com/pgedge/AItoolsFramework/mcp-server/testcases	315.190s

apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "pgedge-nla.fullname" . }}-server-config
  labels:
    {{- include "pgedge-nla.labels" . | nindent 4 }}
data:
  mcp-server.yaml: |
    # pgEdge Natural Language Agent - Server Configuration
    database:
      host: {{ .Values.server.database.host }}
      port: {{ .Values.server.database.port }}
      database: {{ .Values.server.database.database }}
      user: {{ .Values.server.database.user }}
      sslmode: prefer

    http:
      enabled: true
      address: "0.0.0.0:8080"
      auth:
        enabled: true
        token_file: /var/lib/pgedge/mcp-server/tokens.json
        max_failed_attempts_before_lockout: 5
        rate_limit_window_minutes: 15
        rate_limit_max_attempts: 10

    llm:
      enabled: false

    {{- if .Values.server.knowledgebase.enabled }}
    knowledgebase:
      enabled: true
      database_path: /usr/share/pgedge/nla-kb/kb.db
    {{- end }}
